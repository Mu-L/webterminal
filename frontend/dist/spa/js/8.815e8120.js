(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{5941:function(e,t,o){"use strict";var n=o("95f0"),s=o.n(n);s.a},"908c":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"q-pa-md"},[o("q-table",{attrs:{title:"Log",data:e.data,columns:e.columns,filter:e.filter,color:"primary","row-key":"name",loading:e.loading},scopedSlots:e._u([{key:"top",fn:function(t){return[o("q-space"),o("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:e.$t("Search"),filled:""},scopedSlots:e._u([{key:"append",fn:function(){return[o("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!0),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),o("q-btn",{staticClass:"q-ml-md",attrs:{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen"},on:{click:t.toggleFullscreen}})]}},{key:"header",fn:function(t){return[o("q-tr",{attrs:{props:t}},[e._l(t.cols,(function(n){return o("q-th",{key:n.name,attrs:{props:t}},[e._v("\n          "+e._s(n.label)+"\n        ")])})),o("q-th",{attrs:{align:"center"}},[e._v(e._s(e.$t("action")))])],2)]}},{key:"body",fn:function(t){return[o("q-tr",{attrs:{props:t}},[e._l(t.cols,(function(n){return o("q-td",{key:n.name,attrs:{props:t}},[e._v("\n          "+e._s(n.value)+"\n        ")])})),o("q-td",{attrs:{"auto-width":""}},[o("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.row.is_finished&&"ssh"===t.row.tag,expression:"props.row.is_finished && props.row.tag === 'ssh'"}],attrs:{dense:"",round:"",flat:"",color:"grey",icon:"fa fa-play-circle",title:e.$t("log.play_log")},on:{click:function(o){return e.playLog(t)}}}),o("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.row.is_finished&&"ssh"!==t.row.tag&&!t.row.commercial_version,expression:"props.row.is_finished && props.row.tag !== 'ssh' && !props.row.commercial_version"}],attrs:{dense:"",round:"",flat:"",color:"grey",icon:"fa fa-play-circle",title:e.$t("log.play_log")},on:{click:function(o){return e.playGuacamoleLog(t)}}}),o("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.row.is_finished&&t.row.commercial_version,expression:"props.row.is_finished && props.row.commercial_version"}],attrs:{dense:"",round:"",flat:"",color:"grey",icon:"fa fa-play-circle",title:e.$t("log.play_log")},on:{click:function(o){return e.playRdpLog(t)}}}),o("q-btn",{directives:[{name:"show",rawName:"v-show",value:!t.row.is_finished&&!t.row.commercial_version,expression:"!props.row.is_finished && !props.row.commercial_version"}],attrs:{dense:"",round:"",flat:"",color:"grey",icon:"fa fa-eye",title:e.$t("log.monitor")},on:{click:function(o){return e.monitorSession(t)}}}),o("q-btn",{directives:[{name:"show",rawName:"v-show",value:!t.row.is_finished&&t.row.commercial_version,expression:"!props.row.is_finished && props.row.commercial_version"}],attrs:{dense:"",round:"",flat:"",color:"grey",icon:"fa fa-eye",title:e.$t("log.monitor")},on:{click:function(o){return e.monitorRdpSession(t)}}}),o("q-btn",{directives:[{name:"show",rawName:"v-show",value:!t.row.is_finished&&!t.row.commercial_version,expression:"!props.row.is_finished && !props.row.commercial_version"}],attrs:{dense:"",round:"",flat:"",color:"grey",icon:"fa fa-stop-circle",title:e.$t("log.stop")},on:{click:function(o){return e.sessionKill(t)}}}),o("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.row.is_finished&&"ssh"===t.row.tag,expression:"props.row.is_finished && props.row.tag === 'ssh'"}],attrs:{dense:"",round:"",flat:"",color:"grey",icon:"fa fa-terminal",title:e.$t("log.commands")},on:{click:function(o){return e.getCommands(t)}}})],1)],2)]}},{key:"loading",fn:function(){return[o("q-inner-loading",{attrs:{showing:"",color:"primary"}})]},proxy:!0}])}),o("q-dialog",{attrs:{"full-width":"","full-height":"",maximized:!0,draggable:"true"},model:{value:e.logplayermodal,callback:function(t){e.logplayermodal=t},expression:"logplayermodal"}},[o("q-card",[o("q-card-section",{staticClass:"row items-center q-pb-none"},[o("div",{staticClass:"text-h6"},[e._v("\n          "+e._s(e.$t("username"))+": "+e._s(e.log_obj.user.username)+"\n          "+e._s(e.$t("server address"))+": "+e._s(e.log_obj.server.ip)+"\n          "+e._s(e.$t("start date"))+": "+e._s(e.log_obj.start_time)+"\n          "+e._s(e.$t("end date"))+": "+e._s(e.log_obj.end_time)+"\n        ")]),o("q-space"),o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),o("q-card-section",[o("div",{staticStyle:{margin:"0px",padding:"0px",overflow:"hidden"}},[e.show_ssh_player?o("iframe",{staticStyle:{overflow:"hidden",height:"92vh",width:"100%"},attrs:{src:e.player_address,frameborder:"0",allowfullscreen:""}}):e._e(),e._l(e.commands_list,(function(t,n){return o("div",{directives:[{name:"show",rawName:"v-show",value:e.show_ssh_commands,expression:"show_ssh_commands"}],key:n},[e._v("\n            "+e._s(t.datetime)+": "+e._s(t.command)+"\n          ")])})),e.show_ssh_monitor_player?o("terminal-monitor",{attrs:{id:e.sshmonitorchannel}}):e._e(),e.show_guacamole_monitor_player?o("guacamole-monitor",{attrs:{username:e.username,password:e.password,loginuser:e.loginuser,serverid:e.serverid,channel:e.guacamole_channel}}):e._e(),e.show_rdp_player?o("q-media-player",{staticStyle:{overflow:"hidden",height:"92vh",width:"100%","text-align":"center"},attrs:{sources:e.sources,"background-color":"black",type:"video"}}):e._e(),o("div",{directives:[{name:"show",rawName:"v-show",value:e.show_rdp_monitor,expression:"show_rdp_monitor"}],staticStyle:{"background-color":"black"}},[e.show_rdp_monitor?o("q-img",{staticStyle:{height:"768px","max-width":"1024px",display:"block","margin-left":"auto","margin-right":"auto"},attrs:{src:e.imageurl,ratio:1,basic:""},scopedSlots:e._u([{key:"error",fn:function(){return[o("div",{staticClass:"absolute-full flex flex-center bg-black text-white"},[e._v("\n                  "+e._s(e.$t("Session has been ended!"))+"\n                ")])]},proxy:!0}],null,!1,4266892387)}):e._e()],1)],2)])],1)],1)],1)},s=[],a=o("967e"),i=o.n(a),r=(o("96cf"),o("fa84")),l=o.n(r),c=(o("551c"),o("06db"),function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticStyle:{"background-color":"black"},attrs:{id:e.id}})])}),h=[],u=o("fcf3"),d=(o("abb2"),{props:{id:{type:String,required:!0}},name:"MonitorTerminal",data:function(){return{term:null,ws:null}},methods:{},created:function(){},mounted:function(){var e=new u["Terminal"]({cursorBlink:!1,bellStyle:"sound",theme:"black",fullscreenWin:!0});this.term=e;var t=document.getElementById(this.id);t.style.height=window.innerHeight+"px",e.open(t),e.focus();var o="https:"===window.location.protocol?"wss":"ws",n="";n="".concat(o,"://").concat(window.location.hostname,":").concat(window.location.port,"/monitor?channel=").concat(this.id);var s=new WebSocket(n),a=this;s.onopen=function(t){e._initialized=!0,a.ws=s},s.onmessage=function(t){var o=JSON.parse(t.data);e.resize(o[1],o[2]),e.write(o[0])},s.onclose=function(){a.ws=null}},beforeDestroy:function(){console.log("destory")},components:{}}),m=d,p=o("2877"),f=Object(p["a"])(m,c,h,!1,null,null,null),w=f.exports,_=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{ref:"viewport",staticClass:"viewport"},[o("div",{ref:"display",staticClass:"display"})])},g=[],y=(o("ac6a"),o("ac4d"),o("8a81"),o("5df3"),o("1c4c"),o("6b54"),o("f751"),o("7f7f"),o("c5f6"),o("a9c6")),v=o.n(y),b=o("449f"),k=o("cf78"),S=o("268c");function x(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=q(e))){var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw s}}}}function q(e,t){if(e){if("string"===typeof e)return $(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?$(e,t):void 0}}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}v.a.Mouse=b["a"].mouse;var C="",N="",E="https:"===window.location.protocol?"wss":"ws";C="".concat(E,"://").concat(window.location.hostname,":").concat(window.location.port,"/websocket-tunnel"),N="".concat(window.location.protocol,"://").concat(location.host,":").concat(window.location.port,"/tunnel");var T={props:{forceHttp:{type:Boolean,required:!1,default:!1},username:{type:String,required:!0},password:{type:String,required:!0},serverid:{type:Number,required:!1},loginuser:{type:String,required:!1},channel:{type:String,required:!1}},data:function(){return{height:window.innerHeight,connected:!1,display:null,currentAdjustedHeight:null,client:null,keyboard:null,mouse:null,lastEvent:null,connectionState:S["a"].IDLE,arguments:{},errorMessage:"",title:"",query:"username=user&password=pass"}},watch:{connectionState:function(e){e>=5&&(this.errorMessage=S["a"][e].text,this.title=S["a"][e].name)}},name:"GuacamoleMonitor",methods:{send:function(e){if(this.client){var t,o=x(e.data);try{for(o.s();!(t=o.n()).done;){var n=t.value;this.client.sendKeyEvent(1,n.charCodeAt(0))}}catch(s){o.e(s)}finally{o.f()}}},copy:function(e){this.client&&(k["a"].cache={type:"text/plain",data:e.data},k["a"].setRemoteClipboard(this.client))},handleMouseState:function(e){var t=Object.assign({},e,{x:e.x/this.display.getScale(),y:e.y/this.display.getScale()});this.client.sendMouseState(t)},resize:function(){var e=this,t=this.$refs.viewport;if(t&&t.offsetWidth){var o=window.devicePixelRatio||1,n=t.clientWidth*o,s=t.clientHeight*o;this.display.getWidth()===n&&this.display.getHeight()===s||this.client.sendSize(n,s),setTimeout((function(){var o=Math.min(t.clientWidth/Math.max(e.display.getWidth(),1),t.clientHeight/Math.max(e.display.getHeight(),1));e.display.scale(o)}),100)}},connect:function(e){var t,o=this;t=window.WebSocket&&!this.forceHttp?new v.a.WebSocketTunnel(C):new v.a.HTTPTunnel(N,!0),this.client&&(this.display.scale(0),this.uninstallKeyboard()),this.client=new v.a.Client(t),k["a"].install(this.client),t.onerror=function(e){console.error("Tunnel failed ".concat(JSON.stringify(e))),o.connectionState=e.code},t.onstatechange=function(e){switch(console.log("tunnel on state change",e),e){case v.a.Tunnel.State.CONNECTING:o.connectionState=S["a"].CONNECTING;break;case v.a.Tunnel.State.OPEN:o.connectionState=S["a"].CONNECTED;break;case v.a.Tunnel.State.UNSTABLE:break;case v.a.Tunnel.State.CLOSED:o.connectionState=S["a"].DISCONNECTED;break}},this.client.onstatechange=function(e){switch(console.log("client on state change",e),e){case 0:o.connectionState=S["a"].IDLE;break;case 1:break;case 2:o.connectionState=S["a"].WAITING;break;case 3:o.connectionState=S["a"].CONNECTED,window.addEventListener("resize",o.resize),o.$refs.viewport.addEventListener("mouseenter",o.resize),k["a"].setRemoteClipboard(o.client);case 4:case 5:break}},this.client.onerror=function(e){console.log("client on error",e),o.client.disconnect(),console.error("Client error ".concat(JSON.stringify(e))),o.connectionState=e.code},this.client.onsync=function(){},this.client.onargv=function(e,t,n){if("text/plain"===t){var s=new v.a.StringReader(e),a="";s.ontext=function(e){a+=e},s.onend=function(){var e=o.client.createArgumentValueStream("text/plain",n);e.onack=function(e){e.isError()||(o.arguments[n]=a)}}}},this.client.onclipboard=k["a"].onClipboard,this.display=this.client.getDisplay();var n=this.$refs.display;n.appendChild(this.display.getElement()),n.addEventListener("contextmenu",(function(e){e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1})),this.client.connect(e),window.onunload=function(){return o.client.disconnect()},this.mouse=new v.a.Mouse(n),this.mouse.onmouseout=function(){o.display&&o.display.showCursor(!1)},n.onclick=function(){n.focus()},n.onfocus=function(){n.className="focus"},n.onblur=function(){n.className=""},this.keyboard=new v.a.Keyboard(n),this.installKeyboard(),setTimeout((function(){o.resize(),n.focus()}),1e3)},installKeyboard:function(){var e=this;this.keyboard.onkeydown=function(t){e.client.sendKeyEvent(1,t)},this.keyboard.onkeyup=function(t){e.client.sendKeyEvent(0,t)}},uninstallKeyboard:function(){this.keyboard.onkeydown=this.keyboard.onkeyup=function(){}}},mounted:function(){this.query&&!this.connected&&(this.connected=!0,this.connect("username=".concat(this.username,"&password=").concat(this.password,"&uuid=").concat(this.channel)),this.query="username=".concat(this.username,"&password=").concat(this.password,"&uuid=").concat(this.channel))},beforeDestroy:function(){this.client&&this.client.disconnect()}},D=T,j=(o("5941"),Object(p["a"])(D,_,g,!1,null,"397a620a",null)),M=j.exports,L={components:{TerminalMonitor:w,GuacamoleMonitor:M},name:"Log",data:function(){return{columns:[{name:"username",align:"center",label:this.$t("log.table.columns.username.label"),field:function(e){return e.user&&e.user.username?e.user.username:""},sortable:!0},{name:"servername",align:"center",label:this.$t("log.table.columns.servername.label"),field:function(e){return e.server&&e.server.hostname?e.server.hostname:""},sortable:!0},{name:"ip",align:"center",label:this.$t("log.table.columns.ip.label"),field:function(e){return e.server&&e.server.ip?e.server.ip:""},sortable:!0},{name:"start_time",align:"center",label:this.$t("log.table.columns.start_time.label"),field:"start_time",sortable:!0},{name:"is_finished",align:"center",label:this.$t("log.table.columns.is_finished.label"),field:"is_finished",sortable:!0}],data:[],filter:"",loading:!1,logplayermodal:!1,player_address:null,show_ssh_player:!1,show_rdp_player:!1,show_rdp_monitor:!1,show_ssh_commands:!1,show_guacamole_monitor_player:!1,commands_list:[],log_obj:{user:{username:null},server:{ip:null},start_time:null,end_time:null},sshmonitorchannel:null,show_ssh_monitor_player:!1,username:null,password:null,serverid:null,loginuser:null,guacamole_channel:null,sources:[],imageurl:null}},methods:{sessionKill:function(e){var t=this,o=e.row.channel;"ssh"===e.row.tag?this.$axios.post("/common/api/sshterminalkill/",{channel_name:o}).then((function(e){e.data.status?(t.$q.notify({type:"positive",multiline:!0,message:e.data.message,timeout:2e3,position:"top"}),t.fetchData()):t.$q.notify({type:"negative",multiline:!0,message:e.data.message,timeout:2e3,position:"top"})})).catch((function(e){console.log(e)})):(console.log(e),this.$q.notify({type:"negative",multiline:!0,message:"No implement, please wait.",timeout:2e3,position:"top"}))},playLog:function(e){this.logplayermodal=!0,this.show_ssh_player=!0,this.show_ssh_commands=!1,this.show_ssh_monitor_player=!1,this.show_rdp_player=!1,this.show_rdp_monitor=!1,this.player_address="/sshlogplay/".concat(e.row.id,"/"),this.show_guacamole_monitor_player=!1,this.log_obj=e.row},playRdpLog:function(e){this.logplayermodal=!0,this.show_rdp_player=!0,this.show_ssh_commands=!1,this.show_ssh_monitor_player=!1,this.show_ssh_player=!1,this.show_guacamole_monitor_player=!1,this.show_rdp_monitor=!1,this.sources=[{src:"/media/".concat(e.row.channel,"-000000.mp4"),type:"video/mp4"}],this.log_obj=e.row},monitorSession:function(e){this.log_obj=e.row,"ssh"===e.row.tag?(this.logplayermodal=!0,this.show_ssh_commands=!1,this.show_ssh_monitor_player=!0,this.show_ssh_player=!1,this.sshmonitorchannel=e.row.log,this.show_guacamole_monitor_player=!1,this.show_rdp_player=!1,this.show_rdp_monitor=!1):(this.serverid=e.row.server.id,this.loginuser=e.row.loginuser,this.guacamole_channel=e.row.gucamole_client_id,this.show_rdp_player=!1,this.show_rdp_monitor=!1,this.getDynamicUserPassword(e.row.server.id,e.row.loginuser))},monitorRdpSession:function(e){this.logplayermodal=!0;var t=this,o=function(e){return new Promise((function(t,o){return setTimeout(t,e)}))};function n(){return s.apply(this,arguments)}function s(){return s=l()(i.a.mark((function n(){return i.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.logplayermodal){n.next=6;break}return n.next=3,o(50);case 3:t.$axios.get("/common/api/getlastimage/".concat(e.row.channel,"/")).then((function(e){t.imageurl="/common/api/getimage/".concat(e.data.image,"/"),t.show_ssh_player=!1,t.show_rdp_player=!1,t.show_rdp_monitor=!0})),n.next=0;break;case 6:case"end":return n.stop()}}),n)}))),s.apply(this,arguments)}n()},showGuacamoleMonitor:function(){this.logplayermodal=!0,this.show_ssh_commands=!1,this.show_ssh_monitor_player=!1,this.show_ssh_player=!1,this.show_guacamole_monitor_player=!0,this.show_rdp_player=!1,this.show_rdp_monitor=!1},getDynamicUserPassword:function(e,t){var o=this;this.$axios.post("/common/api/getdynamicpassword/",{serverid:e,username:t}).then((function(e){var t=e.data.data.username,n=e.data.data.password;o.username=t,o.password=n,o.dynamicUserPasswordAuth(t,n)})).catch((function(e){console.log(e)}))},dynamicUserPasswordAuth:function(e,t){var o=this;this.$axios.post("/common/api/dynamicpasswordauth/",{username:e,password:t}).then((function(e){o.showGuacamoleMonitor()}))},playGuacamoleLog:function(e){var t=new Date(e.row.start_time),o=t.getMonth()+1,n=t.getDate();this.logplayermodal=!0,this.show_ssh_player=!0,this.show_ssh_commands=!1,this.show_ssh_monitor_player=!1,this.show_guacamole_monitor_player=!1,this.show_rdp_player=!1,this.show_rdp_monitor=!1,this.player_address="/sessionlogplay/?media=".concat(t.getFullYear(),"-").concat(o,"-").concat(n,"/").concat(e.row.channel),this.log_obj=e.row},getCommands:function(e){this.log_obj=e.row,this.show_ssh_player=!1,this.show_ssh_commands=!0,this.show_ssh_monitor_player=!1,this.show_guacamole_monitor_player=!1,this.show_rdp_player=!1,this.show_rdp_monitor=!1,this.fetchCommandsData({id:e.row.id})},fetchData:function(){var e=this;e.loading=!0,this.$axios.get("/common/api/logs/").then((function(t){e.data=t.data,e.loading=!1})).catch((function(t){console.log(t),e.loading=!1}))},fetchCommandsData:function(e){var t=this,o=this;this.$axios.post("/common/api/commandsloglistapi/",e).then((function(e){e.data.status?(t.logplayermodal=!0,o.commands_list=e.data.data):o.$q.notify({type:"negative",multiline:!0,message:e.data.message,timeout:2e3,position:"top"})})).catch((function(e){console.log(e)}))}},created:function(){this.fetchData()}},O=L,I=o("eaac"),A=o("2c91"),Q=o("27f9"),H=o("0016"),K=o("9c40"),P=o("bd08"),W=o("357e"),z=o("db86"),G=o("74f7"),R=o("24e8"),U=o("f09f"),B=o("a370"),J=o("068f"),F=o("7f67"),V=o("eebe"),Y=o.n(V),X=Object(p["a"])(O,n,s,!1,null,"1fa500f2",null);t["default"]=X.exports;Y()(X,"components",{QTable:I["a"],QSpace:A["a"],QInput:Q["a"],QIcon:H["a"],QBtn:K["a"],QTr:P["a"],QTh:W["a"],QTd:z["a"],QInnerLoading:G["a"],QDialog:R["a"],QCard:U["a"],QCardSection:B["a"],QImg:J["a"]}),Y()(X,"directives",{ClosePopup:F["a"]})},"95f0":function(e,t,o){}}]);