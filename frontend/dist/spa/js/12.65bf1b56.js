(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"277f":function(e,t,s){e.exports=s.p+"img/help.857a4dcf.gif"},bc13b:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-splitter",{staticClass:"fit",attrs:{limits:[15,25]},scopedSlots:e._u([{key:"before",fn:function(){return[a("div",{staticClass:"q-pa-md",staticStyle:{overflow:"hidden",height:"100vh",width:"100%","overflow-y":"auto"}},[a("div",{staticClass:"row no-wrap"},[a("q-input",{ref:"filter",staticClass:"bg-white col",attrs:{dense:"",outlined:"",square:"",placeholder:e.searchPlaceholder},on:{focus:e.onSearchFocus,blur:e.onSearchBlur},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),a("q-btn",{attrs:{color:"grey-3","text-color":"grey-8",icon:"search",unelevated:""},on:{click:e.resetFilter}})],1),a("q-tree",{ref:"servertree",attrs:{nodes:e.tree,"node-key":"raw","selected-color":"primary","no-nodes-label":"No Servers",selected:e.selected,filter:e.filter,"filter-method":e.filterServer,"label-key":"label","default-expand-all":""},on:{"update:selected":[function(t){e.selected=t},e.update]}})],1)]},proxy:!0},{key:"after",fn:function(){return[a("div",{staticClass:"q-pa-md"},[a("q-toolbar",{staticClass:"shadow-2 rounded-borders"},[a("q-tabs",{attrs:{align:"left","active-color":"primary",stretch:"","no-caps":"",shrink:"",dense:""},on:{input:e.updatetab},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.tabs,(function(t){return a("q-tab",{key:t.id,attrs:{name:t.name},on:{click:function(s){e.selected=t.name}},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[a("div",[e._v("\n                  "+e._s(t.name)+"\n                  "),a("q-btn",{staticClass:"z-max q-ml-sm",attrs:{"all-pointer-events":"",round:"",dense:"",size:"xs",color:"negative",icon:"close"},on:{click:function(s){return s.stopPropagation(),e.removeTab(t.name)}}})],1)])})),1),a("q-space"),a("q-btn-dropdown",{directives:[{name:"show",rawName:"v-show",value:e.tabs.length>=5,expression:"tabs.length >= 5"}],staticClass:"no-margin no-border-radius no-box-shadow no-outline",attrs:{"no-caps":"",label:e.$t("more")+"...","auto-close":"",stretch:"",flat:""}},[a("q-list",e._l(e.tabs,(function(t){return a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t.id,attrs:{clickable:""},on:{click:function(s){e.selected=t.name}}},[a("q-item-section",[a("q-item-label",[e._v(e._s(t.name))])],1)],1)})),1)],1)],1)],1),a("q-tab-panels",{staticClass:"fit",attrs:{animated:"","keep-alive":""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[a("q-tab-panel",{key:"help",attrs:{name:"help","keep-alive":""}},[a("q-img",{attrs:{src:s("277f")}})],1),e._l(e.tabs,(function(t){return a("q-tab-panel",{key:t.id,staticClass:"no-padding",attrs:{name:t.name,"keep-alive":""}},["ssh"===t.protocol?a("terminal",{ref:"terminal",refInFor:!0,staticStyle:{overflow:"hidden",height:"100vh",width:"100%"},attrs:{id:t.id,loginuser:t.loginuser,username:t.username,serverid:t.serverid,password:t.password}}):e._e(),"rdp"===t.protocol||"vnc"===t.protocol||"telnet"===t.protocol?a("guacamole-client",{ref:"guacamole",refInFor:!0,staticStyle:{overflow:"hidden",height:"89vh",width:"100%"},attrs:{username:t.username,password:t.password,loginuser:t.loginuser,serverid:t.serverid}}):e._e()],1)}))],2)]},proxy:!0}]),model:{value:e.splitterModel,callback:function(t){e.splitterModel=t},expression:"splitterModel"}})],1)},n=[],o=(s("1c4c"),s("ac6a"),s("cadf"),s("06db"),s("5df3"),s("4f7f"),s("4db1")),i=s.n(o),r=(s("28a5"),s("7f7f"),s("7ad4")),l=s("a4ec"),c={name:"Home",data:function(){return{searchFocused:!1,splitterModel:15,selected:"",filter:"",tabs:[{name:"help",id:"help",OriTarget:"help",CurrentIndex:0}],tabsdict:{help:"help"},old_selected:null,tree:[],tree_map:{},can_login_usernames:[]}},watch:{selected:function(e,t){if(console.log("watch selected node change",e,t),this.old_selected=t,null===e&&(this.selected=t),"help"!==e){var s=this;this.$refs.terminal&&this.$refs.terminal.map((function(e){e.id===s.tabsdict[s.selected]&&e.onWindowResize()}))}},splitterModel:function(e,t){console.log(e,t),this.ResizeTerminalWindow()}},methods:{ResizeTerminalWindow:function(){var e=this;"help"!==this.selected&&this.$refs.terminal.map((function(t){t.id===e.tabsdict[e.selected]&&t.onWindowResize()}))},removeTab:function(e){if(console.log("Removing tab",e),"help"!==e){var t=this.tabsdict[e];delete this.tabsdict[e];var s=-1,a=null;this.tabs.map((function(t,n){t.name===e&&(s=n,a=t.username)})),this.$refs.terminal&&this.$refs.terminal.map((function(e){e.id===t&&e.ws&&e.ws.close()})),this.$refs.guacamole&&this.$refs.guacamole.map((function(e){e.username===a&&e.client&&e.client.disconnect()})),this.tabs=this.tabs.filter((function(t,s){return t.name!==e})),this.selected="help",this.selected=this.tabs[s-1].name;try{window.document.getElementById(t)&&window.document.getElementById(t).remove()}catch(n){console.log(n)}}else this.$q.notify({position:"top",progress:!0,message:"You can't remove help tab!",color:"warning",multiLine:!0})},filterServer:function(e,t){var s=t.toLowerCase();return e.label&&e.label.toLowerCase().indexOf(s)>-1},resetFilter:function(){this.filter="",this.$refs.filter.focus()},onSearchFocus:function(){this.searchFocused=!0},onSearchBlur:function(){this.searchFocused=!1},makeid:function(e){for(var t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=s.length,n=0;n<e;n++)t+=s.charAt(Math.floor(Math.random()*a));return t},update:function(e){if(console.log("update target",e),null===e)return this.$q.notify({position:"top",progress:!0,message:"Please re click the node, It can't be null !",color:"warning",multiLine:!0}),void(this.selected=null);e=parseInt(e.split("_")[0]);var t=e;e=this.tree_map[e];var s=e,a=0,n=[];this.tabs.map((function(t){t.OriTarget===e&&n.push(t.CurrentIndex)})),n=n.sort((function(e,t){return e-t})),n.length>1?(a=n[n.length-1]+1,e=0===a?e:e+" ("+a+")"):e=1===n.length?e+" ("+a+")":s;var o=this.makeid(10);this.tabsdict[e]=o,this.loginToWebterminal(t,e,{name:e,id:o,serverid:t,OriTarget:s,CurrentIndex:a,username:"",password:"",loginuser:""})},updatetab:function(e){},fetchData:function(){var e=this;this.can_login_usernames=[],this.$axios.get("/permission/api/getserverlisttree/").then((function(t){e.tree=t.data.tree,e.tree_map=t.data.tree_map,e.can_login_usernames=t.data.can_login_usernames})).then((function(){e.$refs.servertree.expandAll()})).catch((function(e){console.log(e)}))},loginToWebterminal:function(e,t,s){this.getLoginUserName(e,t,s)},getLoginUserName:function(e,t,s){var a=this,n=this;this.$axios.get("/common/api/serverinfowithcredential/".concat(e,"/")).then((function(o){var r=[];if(o.data.credentials.map((function(e){-1!==n.can_login_usernames.indexOf(e.username)&&r.push(e.username)})),r=i()(new Set(r)),r.length>1){console.log("choose the login user name");var l=[];r=Array.from(r),r.map((function(e){l.push({label:e,value:e})})),n.$q.dialog({title:"",message:"Choose your default connect user:",options:{type:"radio",model:"",items:l},cancel:!0,persistent:!0}).onOk((function(o){""!==o?n.getDynamicUserPassword(e,o,t,s):n.selected=a.old_selected})).onCancel((function(){n.selected=a.old_selected})).onDismiss((function(){n.selected=a.old_selected}))}else 1===r.length?n.getDynamicUserPassword(e,r[0],t,s):n.$q.notify({position:"top",progress:!0,message:n.$t("No user can login !"),color:"negative",multiLine:!0})})).catch((function(e){console.log(e)}))},getDynamicUserPassword:function(e,t,s,a){var n=this;this.$axios.post("/common/api/getdynamicpassword/",{serverid:e,username:t}).then((function(e){a.username=e.data.data.username,a.password=e.data.data.password,a.protocol=e.data.data.protocol,a.loginuser=t,"ssh"!==e.data.data.protocol?n.dynamicUserPasswordAuth(s,a):(n.tabs.push(a),n.selected=s)})).catch((function(e){console.log(e)}))},dynamicUserPasswordAuth:function(e,t){var s=this;this.$axios.post("/common/api/dynamicpasswordauth/",{username:t.username,password:t.password}).then((function(a){s.tabs.push(t),s.selected=e}))}},computed:{searchPlaceholder:function(){return!0===this.searchFocused?"Type to start searching...":"Search..."}},created:function(){this.tabs.length>0&&null!==this.selected&&(this.selected="help"),this.fetchData()},beforeDestroy:function(){this.$refs.terminal&&this.$refs.terminal.map((function(e){e.ws&&e.ws.close()})),this.$refs.guacamole&&this.$refs.guacamole.map((function(e){e.client&&e.client.disconnect()}))},components:{Terminal:r["a"],GuacamoleClient:l["a"]}},d=c,u=s("2877"),h=s("8562"),m=s("27f9"),p=s("9c40"),f=s("7f41"),g=s("0016"),b=s("4e73"),v=s("1c1c"),w=s("66e5"),y=s("4074"),_=s("65c6"),k=s("429b"),q=s("7460"),x=s("2c91"),$=s("f20b"),C=s("0170"),Q=s("adad"),T=s("823b"),S=s("068f"),I=s("7f67"),P=s("eebe"),F=s.n(P),L=Object(u["a"])(d,a,n,!1,null,null,null);t["default"]=L.exports;F()(L,"components",{QSplitter:h["a"],QInput:m["a"],QBtn:p["a"],QTree:f["a"],QIcon:g["a"],QMenu:b["a"],QList:v["a"],QItem:w["a"],QItemSection:y["a"],QToolbar:_["a"],QTabs:k["a"],QTab:q["a"],QSpace:x["a"],QBtnDropdown:$["a"],QItemLabel:C["a"],QTabPanels:Q["a"],QTabPanel:T["a"],QImg:S["a"]}),F()(L,"directives",{ClosePopup:I["a"]})}}]);