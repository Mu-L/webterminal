(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{4837:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-splitter",{staticClass:"fit",attrs:{limits:[10,25]},scopedSlots:e._u([{key:"before",fn:function(){return[a("div",{staticClass:"q-pa-md",staticStyle:{overflow:"hidden",height:"100vh",width:"100%","overflow-y":"auto"}},[a("div",{staticClass:"row no-wrap"},[a("q-input",{ref:"filter",staticClass:"bg-white col",attrs:{dense:"",outlined:"",square:"",placeholder:e.searchPlaceholder},on:{focus:e.onSearchFocus,blur:e.onSearchBlur},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),a("q-btn",{attrs:{color:"grey-3","text-color":"grey-8",icon:"search",unelevated:""},on:{click:e.resetFilter}})],1),a("q-tree",{ref:"servertree",attrs:{nodes:e.tree,"node-key":"raw","selected-color":"primary",filter:e.filter,ticked:e.selectednode,"filter-method":e.filterServer,"tick-strategy":"leaf","label-key":"label","default-expand-all":""},on:{"update:ticked":[function(t){e.selectednode=t},e.tickedNode]}})],1)]},proxy:!0},{key:"after",fn:function(){return[a("div",{staticClass:"q-pa-md"},[a("q-toolbar",{staticClass:"shadow-2 rounded-borders"},[a("q-tabs",{attrs:{align:"left","active-color":"primary",stretch:"","no-caps":"",shrink:"",dense:""},on:{input:e.updatetab},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.tabs,(function(t){return a("q-tab",{key:t.id,attrs:{name:t.name},on:{click:function(n){e.selected=t.name}},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[a("div",[e._v("\n                "+e._s(t.name)+"\n                "),a("q-btn",{staticClass:"z-max q-ml-sm",attrs:{"all-pointer-events":"",round:"",dense:"",size:"xs",color:"negative",icon:"close"},on:{click:function(n){return n.stopPropagation(),e.removeTab(t.name)}}})],1)])})),1),a("q-space"),a("q-btn-dropdown",{directives:[{name:"show",rawName:"v-show",value:e.tabs.length>=5,expression:"tabs.length >= 5"}],staticClass:"no-margin no-border-radius no-box-shadow no-outline",attrs:{"no-caps":"",label:e.$t("more")+"...","auto-close":"",stretch:"",flat:""}},[a("q-list",e._l(e.tabs,(function(t){return a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t.id,attrs:{clickable:""},on:{click:function(n){e.selected=t.name}}},[a("q-item-section",[a("q-item-label",[e._v(e._s(t.name))])],1)],1)})),1)],1)],1)],1),a("q-tab-panels",{staticClass:"fit",attrs:{animated:"","keep-alive":""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[a("q-tab-panel",{key:"help",attrs:{name:"help","keep-alive":""}},[a("q-img",{attrs:{src:n("641b")}})],1),e._l(e.tabs,(function(t){return a("q-tab-panel",{key:t.id,staticClass:"no-padding",attrs:{name:t.name,"keep-alive":""}},["ssh"===t.protocol?a("terminal",{ref:"terminal",refInFor:!0,staticStyle:{overflow:"hidden",height:"100vh",width:"100%"},attrs:{ip:t.ip,commandid:t.commandid,id:t.id,loginuser:t.loginuser,username:t.username,serverid:t.serverid,password:t.password}}):e._e()],1)}))],2)]},proxy:!0}]),model:{value:e.splitterModel,callback:function(t){e.splitterModel=t},expression:"splitterModel"}})],1)},s=[],i=(n("1c4c"),n("ac6a"),n("cadf"),n("06db"),n("5df3"),n("4f7f"),n("4db1")),r=n.n(i),o=(n("28a5"),n("7f7f"),n("6762"),n("2fdb"),n("7ad4")),l={name:"CommandExecute",data:function(){return{searchFocused:!1,splitterModel:15,selected:"",filter:"",tabs:[{name:"help",id:"help",OriTarget:"help",CurrentIndex:0}],tabsdict:{help:"help"},tree:[],tree_map:{},can_login_usernames:[],selectednode:[]}},watch:{selected:function(e,t){if(null===e&&(this.selected=t),"help"!==e){var n=this;this.$refs.terminal&&this.$refs.terminal.map((function(e){e.id===n.tabsdict[n.selected]&&e.onWindowResize()}))}},splitterModel:function(e,t){this.ResizeTerminalWindow()}},methods:{tickedNode:function(e){var t=this;e.map((function(e){var n=t.tabs.filter((function(t,n){return t.originalValue===e}));1===n.length?console.log("exist"):t.update(e)})),this.tabs.map((function(n){var a=t.tabs.filter((function(t,n){return!e.includes(t.originalValue)&&"help"!==t.id}));1===a.length&&t.removeTab(a[0].name)}))},ResizeTerminalWindow:function(){var e=this;"help"!==this.selected&&this.$refs.terminal.map((function(t){t.id===e.tabsdict[e.selected]&&t.onWindowResize()}))},removeTab:function(e){if("help"!==e){var t=this.tabsdict[e],n=-1,a=this.tabs.filter((function(e,n){return e.id===t}));1===a.length&&(n=this.selectednode.indexOf(a[0].originalValue)),delete this.tabsdict[e],n>-1&&this.selectednode.splice(n,1);var s=-1;this.tabs.map((function(t,n){t.name===e&&(s=n)})),this.$refs.terminal&&this.$refs.terminal.map((function(e){e.id===t&&e.ws&&e.ws.close()})),this.tabs=this.tabs.filter((function(t,n){return t.name!==e})),this.selected="help",this.tabs[s-1]&&(this.selected=this.tabs[s-1].name);try{window.document.getElementById(t)&&window.document.getElementById(t).remove()}catch(i){console.log(i)}}else this.$q.notify({position:"top",progress:!0,message:"You can't remove help tab!",color:"warning",multiLine:!0})},filterServer:function(e,t){var n=t.toLowerCase();return e.label&&e.label.toLowerCase().indexOf(n)>-1},resetFilter:function(){this.filter="",this.$refs.filter.focus()},onSearchFocus:function(){this.searchFocused=!0},onSearchBlur:function(){this.searchFocused=!1},makeid:function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=n.length,s=0;s<e;s++)t+=n.charAt(Math.floor(Math.random()*a));return t},update:function(e){if(null===e)return this.$q.notify({position:"top",progress:!0,message:"Please re click the node, It can't be null !",color:"warning",multiLine:!0}),void(this.selected=null);var t=parseInt(e.split("_")[0]),n=e,a=this.makeid(10);this.loginToWebterminal(t,n,{name:e,id:a,serverid:t,OriTarget:this.tree_map[t],CurrentIndex:0,username:"",password:"",loginuser:""})},updatetab:function(e){},fetchData:function(){var e=this;this.can_login_usernames=[],this.$axios.get("/permission/api/getcommandlisttree/").then((function(t){e.tree=t.data.tree,e.tree_map=t.data.tree_map,e.can_login_usernames=t.data.can_login_usernames})).then((function(){e.$refs.servertree.expandAll()})).catch((function(e){console.log(e)}))},loginToWebterminal:function(e,t,n){this.getLoginUserName(e,t,n)},getLoginUserName:function(e,t,n){var a=this,s=this;this.$axios.get("/common/api/serverinfowithcredential/".concat(e,"/")).then((function(i){var o=[];if(i.data.credentials.map((function(e){-1!==s.can_login_usernames.indexOf(e.username)&&o.push(e.username)})),o=r()(new Set(o)),o.length>1){var l=[];o=Array.from(o),o.map((function(e){l.push({label:e,value:e})})),s.$q.dialog({title:"",message:"Choose your default connect user:",options:{type:"radio",model:"",items:l},cancel:!0,persistent:!0}).onOk((function(a){""!==a&&s.getDynamicUserPassword(e,a,t,n)})).onCancel((function(){var e=-1;e=s.selectednode.indexOf(t),a.selectednode.splice(e,1)}))}else 1===o.length?s.getDynamicUserPassword(e,o[0],t,n):console.log("no user can login")})).catch((function(e){console.log(e)}))},getDynamicUserPassword:function(e,t,n,a){var s=this,i=this,r=n;this.$axios.post("/common/api/getdynamicpassword/",{serverid:e,username:t}).then((function(o){n=s.tree_map[e];var l=n,c=0,d=[];s.tabs.map((function(e){e.OriTarget===n&&d.push(e.CurrentIndex)})),d=d.sort((function(e,t){return e-t})),d.length>1?(c=d[d.length-1]+1,n=0===c?n:n+" ("+c+")"):n=1===d.length?n+" ("+c+")":l,i.tabsdict[n]=a.id,a.username=o.data.data.username,a.password=o.data.data.password,a.protocol=o.data.data.protocol,a.loginuser=t,a.ip=o.data.data.ip,a.originalValue=r,a.name=n,a.CurrentIndex=c,i.$refs.servertree.getNodeByKey(r)&&(a.commandid=i.$refs.servertree.getNodeByKey(r).commandid),i.tabs.push(a),i.selected=a.name})).catch((function(e){console.log(e)}))}},computed:{searchPlaceholder:function(){return!0===this.searchFocused?"Type to start searching...":"Search..."}},created:function(){this.tabs.length>0&&null!==this.selected&&(this.selected="help"),this.fetchData()},components:{Terminal:o["a"]}},c=l,d=n("2877"),u=n("8562"),f=n("27f9"),h=n("9c40"),m=n("7f41"),p=n("65c6"),b=n("429b"),g=n("7460"),v=n("2c91"),w=n("f20b"),y=n("1c1c"),k=n("66e5"),x=n("4074"),_=n("0170"),q=n("adad"),C=n("823b"),T=n("068f"),Q=n("7f67"),$=n("eebe"),I=n.n($),S=Object(d["a"])(c,a,s,!1,null,"f9527c80",null);t["default"]=S.exports;I()(S,"components",{QSplitter:u["a"],QInput:f["a"],QBtn:h["a"],QTree:m["a"],QToolbar:p["a"],QTabs:b["a"],QTab:g["a"],QSpace:v["a"],QBtnDropdown:w["a"],QList:y["a"],QItem:k["a"],QItemSection:x["a"],QItemLabel:_["a"],QTabPanels:q["a"],QTabPanel:C["a"],QImg:T["a"]}),I()(S,"directives",{ClosePopup:Q["a"]})},"641b":function(e,t,n){e.exports=n.p+"img/help1.c6dc07d7.gif"}}]);