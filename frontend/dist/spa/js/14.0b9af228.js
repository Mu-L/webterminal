(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{d7e0:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("q-splitter",{staticClass:"fit",attrs:{limits:[10,25]},scopedSlots:e._u([{key:"before",fn:function(){return[n("div",{staticClass:"q-pa-md",staticStyle:{overflow:"hidden",height:"100vh",width:"100%","overflow-y":"auto"}},[n("div",{staticClass:"row no-wrap"},[n("q-input",{ref:"filter",staticClass:"bg-white col",attrs:{dense:"",outlined:"",square:"",placeholder:e.searchPlaceholder},on:{focus:e.onSearchFocus,blur:e.onSearchBlur},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),n("q-btn",{attrs:{color:"grey-3","text-color":"grey-8",icon:"search",unelevated:""},on:{click:e.resetFilter}})],1),n("q-tree",{ref:"servertree",attrs:{nodes:e.tree,"node-key":"raw","selected-color":"primary",filter:e.filter,ticked:e.selectednode,"filter-method":e.filterServer,"tick-strategy":"leaf","label-key":"label","default-expand-all":""},on:{"update:ticked":[function(t){e.selectednode=t},e.tickedNode]}})],1)]},proxy:!0},{key:"after",fn:function(){return[n("div",{staticClass:"q-pa-md"},[n("div",{staticClass:"row q-col-gutter-x-xs q-col-gutter-y-lg"},[n("div",{staticClass:"col-12"},[n("q-select",{attrs:{filled:"",value:e.command,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",options:e.options,"aria-required":"true"},on:{filter:e.filterFn,"input-value":e.setModel,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.execute(t)}},scopedSlots:e._u([{key:"no-option",fn:function(){return[n("q-item",[n("q-item-section",{staticClass:"text-grey"},[e._v("\n                    No results\n                  ")])],1)]},proxy:!0},{key:"after",fn:function(){return[n("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"play_arrow",title:"execute"},on:{click:e.execute}})]},proxy:!0}])})],1)]),n("div",{staticClass:"q-pa-md"},[n("div",{staticClass:"row q-col-gutter-x-xs q-col-gutter-y-lg"},e._l(e.tabs,(function(t){return n("div",{key:t.id,staticClass:"col-6",attrs:{"keep-alive":""}},[n("q-bar",{staticClass:"bg-teal text-white",attrs:{dense:""}},[n("q-space"),n("q-btn",{attrs:{dense:"",flat:"",icon:"minimize"}}),n("q-btn",{attrs:{dense:"",flat:"",icon:"crop_square"}}),n("q-btn",{attrs:{dense:"",flat:"",icon:"close"},on:{click:function(n){return n.stopPropagation(),e.closeWindow(t.originalValue)}}})],1),n("terminal",{ref:"terminal",refInFor:!0,staticStyle:{overflow:"hidden",height:"200px",width:"100%"},attrs:{showtoolbar:!1,id:t.id,loginuser:t.loginuser,username:t.username,serverid:t.serverid,password:t.password}})],1)})),0)])])]},proxy:!0}]),model:{value:e.splitterModel,callback:function(t){e.splitterModel=t},expression:"splitterModel"}})],1)},i=[],a=(n("1c4c"),n("ac6a"),n("cadf"),n("06db"),n("5df3"),n("4f7f"),n("4db1")),s=n.n(a),r=(n("28a5"),n("6762"),n("2fdb"),n("7ad4")),l={name:"BatchCommandExecute",data:function(){return{searchFocused:!1,splitterModel:15,filter:"",tabs:[],tree:[],can_login_usernames:[],selectednode:[],command:null,options:[],selectNodeKey:null}},watch:{splitterModel:function(e,t){this.ResizeTerminalWindow()}},methods:{tickedNode:function(e){var t=this;e.map((function(e){var n=t.tabs.filter((function(t,n){return t.originalValue===e}));1===n.length?console.log("exist"):t.update(e)})),this.tabs.map((function(n){var o=t.tabs.filter((function(t,n){return!e.includes(t.originalValue)&&"help"!==t.id}));1===o.length&&t.closeWindow(o[0].originalValue)}))},execute:function(){var e=this;this.$refs.terminal&&this.$refs.terminal.map((function(t){t.ws&&t.ws.send("".concat(e.command,"\n"))}))},filterFn:function(e,t,n){var o=this;t((function(){var t=e.toLocaleLowerCase();o.fetchAutoCompeleteCommandslist(t)}))},setModel:function(e){this.command=e},ResizeTerminalWindow:function(){this.$refs.terminal&&this.$refs.terminal.map((function(e){e.onWindowResize()}))},closeWindow:function(e){var t=this.tabs.filter((function(t,n){return t.originalValue===e})),n=null;1===t.length&&(n=t[0].id);var o=-1;o=this.selectednode.indexOf(e),o>-1&&this.selectednode.splice(o,1),this.$refs.terminal&&this.$refs.terminal.map((function(e){e.id===n&&e.ws&&e.ws.close()})),this.tabs=this.tabs.filter((function(t,n){return t.originalValue!==e}));try{window.document.getElementById(n)&&window.document.getElementById(n).remove()}catch(i){console.log(i)}},filterServer:function(e,t){var n=t.toLowerCase();return e.label&&e.label.toLowerCase().indexOf(n)>-1},resetFilter:function(){this.filter="",this.$refs.filter.focus()},onSearchFocus:function(){this.searchFocused=!0},onSearchBlur:function(){this.searchFocused=!1},makeid:function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,i=0;i<e;i++)t+=n.charAt(Math.floor(Math.random()*o));return t},update:function(e){var t=parseInt(e.split("_")[0]),n=this.makeid(10);this.loginToWebterminal(t,e,{name:e,id:n,serverid:t,username:"",password:"",loginuser:""})},fetchData:function(){var e=this;this.can_login_usernames=[],this.$axios.get("/permission/api/getlinuxserverlisttree/").then((function(t){e.tree=t.data.tree,e.can_login_usernames=t.data.can_login_usernames})).then((function(){e.$refs.servertree.expandAll()})).catch((function(e){console.log(e)}))},fetchAutoCompeleteCommandslist:function(e){var t=this;this.$axios.post("/common/api/commandautocompeleteapi/",{cmd:e}).then((function(e){t.options=e.data.data})).catch((function(e){console.log(e)}))},loginToWebterminal:function(e,t,n){this.getLoginUserName(e,t,n)},getLoginUserName:function(e,t,n){var o=this,i=this;this.$axios.get("/common/api/serverinfowithcredential/".concat(e,"/")).then((function(a){var r=[];if(a.data.credentials.map((function(e){-1!==i.can_login_usernames.indexOf(e.username)&&r.push(e.username)})),r=s()(new Set(r)),r.length>1){var l=[];r=Array.from(r),r.map((function(e){l.push({label:e,value:e})})),i.$q.dialog({title:"",message:"Choose your default connect user:",options:{type:"radio",model:"",items:l},cancel:!0,persistent:!0}).onOk((function(o){""!==o&&i.getDynamicUserPassword(e,o,t,n)})).onCancel((function(){var e=-1;e=i.selectednode.indexOf(t),o.selectednode.splice(e,1)}))}else 1===r.length?i.getDynamicUserPassword(e,r[0],t,n):console.log("no user can login")})).catch((function(e){console.log(e)}))},getDynamicUserPassword:function(e,t,n,o){var i=this;this.$axios.post("/common/api/getdynamicpassword/",{serverid:e,username:t}).then((function(e){o.username=e.data.data.username,o.password=e.data.data.password,o.protocol=e.data.data.protocol,o.loginuser=t,o.originalValue=n,"ssh"===e.data.data.protocol&&i.tabs.push(o)})).catch((function(e){console.log(e)}))}},computed:{searchPlaceholder:function(){return!0===this.searchFocused?"Type to start searching...":"Search..."}},beforeDestroy:function(){this.$refs.terminal&&this.$refs.terminal.map((function(e){e.ws&&e.ws.close()}))},created:function(){this.fetchData(),this.fetchAutoCompeleteCommandslist("")},components:{Terminal:r["a"]}},c=l,d=n("2877"),u=n("8562"),f=n("27f9"),h=n("9c40"),m=n("7f41"),p=n("ddd8"),g=n("66e5"),v=n("4074"),w=n("d847"),y=n("2c91"),b=n("eebe"),x=n.n(b),k=Object(d["a"])(c,o,i,!1,null,"e7e0bd50",null);t["default"]=k.exports;x()(k,"components",{QSplitter:u["a"],QInput:f["a"],QBtn:h["a"],QTree:m["a"],QSelect:p["a"],QItem:g["a"],QItemSection:v["a"],QBar:w["a"],QSpace:y["a"]})}}]);