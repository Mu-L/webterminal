(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{"15a4":function(e,a,t){"use strict";t.r(a);var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",["ssh"===e.tab.protocol?t("terminal",{ref:"terminal",staticStyle:{overflow:"hidden",height:"100vh",width:"100%"},attrs:{id:e.tab.id,loginuser:e.tab.loginuser,username:e.tab.username,serverid:e.tab.serverid,password:e.tab.password}}):e._e(),"rdp"===e.tab.protocol||"vnc"===e.tab.protocol||"telnet"===e.tab.protocol?t("guacamole-client",{ref:"guacamole",staticStyle:{overflow:"hidden",height:"89vh",width:"100%"},attrs:{username:e.tab.username,password:e.tab.password,loginuser:e.tab.loginuser,serverid:e.tab.serverid}}):e._e()],1)},o=[],s=(t("1c4c"),t("ac6a"),t("cadf"),t("06db"),t("5df3"),t("4f7f"),t("4db1")),r=t.n(s),i=t("7ad4"),c=t("a4ec"),l=t("e669"),d={name:"WebTerminal",data:function(){return{tab:{},can_login_usernames:[]}},methods:{makeid:function(e){for(var a="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,o=0;o<e;o++)a+=t.charAt(Math.floor(Math.random()*n));return a},update:function(e){console.log("update target",e);var a=parseInt(e),t=this.makeid(10);this.loginToWebterminal(a,{id:t,serverid:a,username:"",password:"",loginuser:""})},loginToWebterminal:function(e,a){this.getLoginUserName(e,a)},getLoginUserName:function(e,a){var t=this,n=this;this.$axios.get("/common/api/serverinfowithcredential/".concat(e,"/")).then((function(o){var s=[];if(o.data.credentials.map((function(e){-1!==n.can_login_usernames.indexOf(e.username)&&s.push(e.username)})),s=r()(new Set(s)),s.length>1){console.log("choose the login user name");var i=[];s=Array.from(s),s.map((function(e){i.push({label:e,value:e})})),n.$q.dialog({title:"",message:"Choose your default connect user:",options:{type:"radio",model:"",items:i},cancel:!0,persistent:!0}).onOk((function(o){""!==o?n.getDynamicUserPassword(e,o,a):n.selected=t.old_selected})).onCancel((function(){n.selected=t.old_selected})).onDismiss((function(){n.selected=t.old_selected}))}else 1===s.length?n.getDynamicUserPassword(e,s[0],a):n.$q.notify({position:"top",progress:!0,message:n.$t("No user can login !"),color:"negative",multiLine:!0})})).catch((function(e){console.log(e)}))},getDynamicUserPassword:function(e,a,t){var n=this;this.$axios.post("/common/api/getdynamicpassword/",{serverid:e,username:a}).then((function(e){t.username=e.data.data.username,t.password=e.data.data.password,t.protocol=e.data.data.protocol,t.loginuser=a,"ssh"!==e.data.data.protocol?n.dynamicUserPasswordAuth(t):n.tab=t})).catch((function(e){console.log(e)}))},dynamicUserPasswordAuth:function(e){var a=this;this.$axios.post("/common/api/dynamicpasswordauth/",{username:e.username,password:e.password}).then((function(t){a.tab=e}))}},components:{Terminal:i["a"],GuacamoleClient:c["a"]},created:function(){console.log(this.$route.params.id),this.$q.loading.show({spinner:l["a"],spinnerColor:"green",spinnerSize:140,backgroundColor:"purple",message:'Try to connect the <b>server</b>.<br/><span class="text-primary">Hang on...</span>',messageColor:"black"});var e=this;this.can_login_usernames=[],this.$axios.get("/permission/api/getserverlisttree/").then((function(a){e.can_login_usernames=a.data.can_login_usernames})).then((function(){e.$route.params.id?(e.$q.loading.hide(),e.update(e.$route.params.id)):e.update(null)})).catch((function(e){console.log(e)}))}},u=d,m=t("2877"),p=Object(m["a"])(u,n,o,!1,null,"e23552ec",null);a["default"]=p.exports}}]);